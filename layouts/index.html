{{ define "main" }}
<div class="home">
    {{ $posts := sort (where .Site.RegularPages "Section" "posts") "Date" "desc" }}
    {{ $notes := sort (where .Site.RegularPages "Section" "notes") "Date" "desc" }}
    {{ $links := sort (where .Site.RegularPages "Section" "links") "Date" "desc" }}

    <section class="home-section">
        <h2 class="section-header">Posts</h2>
        <div class="home-stream">
            {{ range first 5 $posts }}
            <article class="stream-item stream-posts">
                <div class="stream-row">
                    <h2 class="stream-title">
                        <a href="{{ .Permalink }}">{{ .Title }}</a>
                    </h2>
                    <time class="stream-time" datetime="{{ .Date.Format "2006-01-02" }}">
                        {{ .Date.Format "2006-01-02" }}
                    </time>
                </div>
            </article>
            {{ end }}
        </div>
        <div class="section-more">
            <a href="/posts/" class="section-link">See all posts →</a>
        </div>
    </section>

    <section class="home-section">
        <h2 class="section-header">Notes</h2>
        <div class="home-stream">
            {{ range first 5 $notes }}
            <article class="stream-item stream-notes">
                <div class="stream-row">
                    <h2 class="stream-title">
                        <a href="{{ .Permalink }}">{{ .Title }}</a>
                    </h2>
                    <time class="stream-time" datetime="{{ .Date.Format "2006-01-02" }}">
                        {{ .Date.Format "2006-01-02" }}
                    </time>
                </div>
            </article>
            {{ end }}
        </div>
        <div class="section-more">
            <a href="/notes/" class="section-link">See all notes →</a>
        </div>
    </section>

    <section class="home-section">
        <h2 class="section-header">Links</h2>
        <div class="home-stream">
            {{ range first 5 $links }}
            {{ $linkPage := . }}
            <article class="stream-item stream-links">
                <div class="stream-meta">
                    <time class="stream-time" datetime="{{ .Date.Format "2006-01-02" }}">
                        {{ .Date.Format "2006-01-02" }}
                    </time>
                </div>

                <div class="stream-content">
                    {{ with $linkPage.Params.link }}
                    <h3 class="stream-link-title">
                        <a href="{{ . }}" target="_blank" rel="noopener">{{ $linkPage.Title }} →</a>
                    </h3>
                    <div class="stream-link-url">{{ . | replaceRE "^https?://(www\\.)?" "" | truncate 50 }}</div>
                    {{ end }}
                    {{ with $linkPage.Content }}
                    <div class="stream-note">{{ . }}</div>
                    {{ end }}
                </div>
            </article>
            {{ end }}
        </div>
        <div class="section-more">
            <a href="/links/" class="section-link">See all links ({{ len $links }}) →</a>
        </div>
    </section>
</div>
{{ end }}
